<!DOCTYPE html>
<html lang="en">
<head>
    <title>CPSC 487/587</title>
    <script src="../../js/setup/setup_mathjax.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.3.0/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quaternion@1.5.1/quaternion.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/numeric@1.2.6/numeric-1.2.6.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    <script type="importmap">
        {
            "imports": {
              "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
              "three/": "https://unpkg.com/three@0.160.0/"
            }
        }
    </script>
</head>
<body>
<script type="module">
    import {ThreeEngine} from "../js/utils/utils_three.js";
    import {TransformGizmoEngine} from "../js/utils/utils_transform_gizmo.js";
    import {identity_matrix} from "../js/utils/utils_math.js";
    import {get_default_lil_gui} from "../js/utils/utils_three.js";
    import {add_matrix_matrix, mul_matrix_scalar} from "../js/utils/utils_math.js";
    import {refresh_displays} from "../js/utils/utils_three.js";

    let engine = ThreeEngine.new_default_2d();

    let settings = {
        t: 0,
        gizmos_visible:true
    };
    let is_playing = false;
    let actions = {
        play: () => {
            is_playing = true;
        },
        stop: () => {
            is_playing = false;
        }
    }
    let gui = get_default_lil_gui();
    gui.add(settings, 't', 0, 6).name('u');
    gui.add(settings, 'gizmos_visible').name('Gizmos visible');
    gui.add(actions, 'play');
    gui.add(actions, 'stop');

    let tge = new TransformGizmoEngine(engine);

    tge.add_gizmo_SO2_matrix_and_position(engine, identity_matrix(2), [-1, 1], 0.2);
    tge.add_gizmo_SO2_matrix_and_position(engine, identity_matrix(2), [-0.5, 0.2], 0.2);
    tge.add_gizmo_SO2_matrix_and_position(engine, identity_matrix(2), [0, 0], 0.2);
    tge.add_gizmo_SO2_matrix_and_position(engine, identity_matrix(2), [0.4, 0.2], 0.2);
    tge.add_gizmo_SO2_matrix_and_position(engine, identity_matrix(2), [0.8, 0.8], 0.2);
    tge.add_gizmo_SO2_matrix_and_position(engine, identity_matrix(2), [1.5, 1.3], 0.2);

    engine.animation_loop(function() {
        tge.set_visibility_of_all_gizmos(engine, settings.gizmos_visible);

        if(is_playing) {
            settings.t += 0.01;
            if(settings.t > 6) { settings.t = 0; }
            refresh_displays(gui);
        }

        let p1 = tge.get_gizmo_pose_as_SO2_matrix_and_position(0)[1];
        let p2 = tge.get_gizmo_pose_as_SO2_matrix_and_position(1)[1];
        let p3 = tge.get_gizmo_pose_as_SO2_matrix_and_position(2)[1];
        let p4 = tge.get_gizmo_pose_as_SO2_matrix_and_position(3)[1];
        let p5 = tge.get_gizmo_pose_as_SO2_matrix_and_position(4)[1];
        let p6 = tge.get_gizmo_pose_as_SO2_matrix_and_position(5)[1];

        engine.draw_debug_line(p1, p2, false, 0.03, 0x222222);
        engine.draw_debug_line(p2, p3, false, 0.03, 0x222222);
        engine.draw_debug_line(p3, p4, false, 0.03, 0x222222);
        engine.draw_debug_line(p4, p5, false, 0.03, 0x222222);
        engine.draw_debug_line(p5, p6, false, 0.03, 0x222222);
        engine.draw_debug_line(p6, p1, false, 0.03, 0x222222);

        if(settings.t < 1) {
            engine.draw_debug_sphere( add_matrix_matrix(mul_matrix_scalar(p1, 1-settings.t), mul_matrix_scalar(p2, settings.t)), 0.08, 0x00eeff);
        } else if (settings.t < 2) {
            engine.draw_debug_sphere( add_matrix_matrix(mul_matrix_scalar(p2, 1-(settings.t-1)), mul_matrix_scalar(p3, (settings.t-1))), 0.08, 0x00eeff);
        } else if (settings.t < 3) {
            engine.draw_debug_sphere( add_matrix_matrix(mul_matrix_scalar(p3, 1-(settings.t-2)), mul_matrix_scalar(p4, (settings.t-2))), 0.08, 0x00eeff);
        } else if (settings.t < 4) {
            engine.draw_debug_sphere( add_matrix_matrix(mul_matrix_scalar(p4, 1-(settings.t-3)), mul_matrix_scalar(p5, (settings.t-3))), 0.08, 0x00eeff);
        } else if (settings.t < 5) {
            engine.draw_debug_sphere( add_matrix_matrix(mul_matrix_scalar(p5, 1-(settings.t-4)), mul_matrix_scalar(p6, (settings.t-4))), 0.08, 0x00eeff);
        } else {
            engine.draw_debug_sphere( add_matrix_matrix(mul_matrix_scalar(p6, 1-(settings.t-5)), mul_matrix_scalar(p1, (settings.t-5))), 0.08, 0x00eeff);
        }
    });

</script>
</body>
</html>