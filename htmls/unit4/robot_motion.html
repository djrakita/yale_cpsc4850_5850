<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yale Geometric Algebra Workshop</title>
    <script src="../../js/setup/setup_mathjax.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js@0.17.0/build/stats.min.js"></script>
    <script type="importmap">
        {
            "imports": {
              "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
              "three/": "https://unpkg.com/three@0.160.0/"
            }
        }
    </script>
</head>
<body>
    <script type="module">
        import {ThreeEngine} from '../js/utils/utils_three.js'
        import {XArm7Robot} from "../js/utils/utils_robot.js";
        import {set_robot_state} from "../js/utils/utils_kinematics_obfuscated.js";
        import {get_default_lil_gui} from "../js/utils/utils_three.js";
        import {refresh_displays} from "../js/utils/utils_three.js";

        let engine = ThreeEngine.new_default_3d();

        let robot = new XArm7Robot();
        robot.spawn_robot(engine);

        let robot2 = new XArm7Robot();
        robot2.spawn_robot(engine);

        let robot3 = new XArm7Robot();
        robot3.spawn_robot(engine);

        let settings = {
            dof1_start: 0,
            dof2_start: 0,
            dof3_start: 0,
            dof4_start: 0,
            dof5_start: 0,
            dof6_start: 0,
            dof7_start: 0,
            dof8_start: 0,
            dof1_end: 0,
            dof2_end: 0,
            dof3_end: 0,
            dof4_end: 0,
            dof5_end: 0,
            dof6_end: 0,
            dof7_end: 0,
            dof8_end: 0,
            dof1: 0,
            dof2: 0,
            dof3: 0,
            dof4: 0,
            dof5: 0,
            dof6: 0,
            dof7: 0,
            dof8: 0,
            t:0,
            is_playing:false
        }

        let gui = get_default_lil_gui();
        let folder1 = gui.addFolder('Start State');
        folder1.add(settings, 'dof1_start', 0, 0.8);
        folder1.add(settings, 'dof2_start', -6.283, 6.283);
        folder1.add(settings, 'dof3_start', -2.059, 2.059);
        folder1.add(settings, 'dof4_start', -6.283, 6.283);
        folder1.add(settings, 'dof5_start', -0.191, 3.927);
        folder1.add(settings, 'dof6_start', -6.283, 6.283);
        folder1.add(settings, 'dof7_start', -1.692, 3.141);
        folder1.add(settings, 'dof8_start', -6.283, 6.283);

        let folder2 = gui.addFolder('End State');
        folder2.add(settings, 'dof1_end', 0, 0.8);
        folder2.add(settings, 'dof2_end', -6.283, 6.283);
        folder2.add(settings, 'dof3_end', -2.059, 2.059);
        folder2.add(settings, 'dof4_end', -6.283, 6.283);
        folder2.add(settings, 'dof5_end', -0.191, 3.927);
        folder2.add(settings, 'dof6_end', -6.283, 6.283);
        folder2.add(settings, 'dof7_end', -1.692, 3.141);
        folder2.add(settings, 'dof8_end', -6.283, 6.283);

        let folder3 = gui.addFolder('State');
        folder3.add(settings, 'dof1').disable();
        folder3.add(settings, 'dof2').disable();
        folder3.add(settings, 'dof3').disable();
        folder3.add(settings, 'dof4').disable();
        folder3.add(settings, 'dof5').disable();
        folder3.add(settings, 'dof6').disable();
        folder3.add(settings, 'dof7').disable();
        folder3.add(settings, 'dof8').disable();

        let actions = {
            play: function() {
                settings.is_playing = !settings.is_playing;
            }
        };

        let folder4 = gui.addFolder('Controls')
        folder4.add(settings, 't', 0, 1)
        folder4.add(actions, 'play').name('play/stop');

        engine.animation_loop(() => {
            set_robot_state(engine, robot2, [settings.dof1_start, settings.dof2_start, settings.dof3_start, settings.dof4_start, settings.dof5_start, settings.dof6_start, settings.dof7_start, settings.dof8_start])
            set_robot_state(engine, robot3, [settings.dof1_end, settings.dof2_end, settings.dof3_end, settings.dof4_end, settings.dof5_end, settings.dof6_end, settings.dof7_end, settings.dof8_end])

            let s1 = (1.0 - settings.t) * settings.dof1_start + settings.t * settings.dof1_end;
            let s2 = (1.0 - settings.t) * settings.dof2_start + settings.t * settings.dof2_end;
            let s3 = (1.0 - settings.t) * settings.dof3_start + settings.t * settings.dof3_end;
            let s4 = (1.0 - settings.t) * settings.dof4_start + settings.t * settings.dof4_end;
            let s5 = (1.0 - settings.t) * settings.dof5_start + settings.t * settings.dof5_end;
            let s6 = (1.0 - settings.t) * settings.dof6_start + settings.t * settings.dof6_end;
            let s7 = (1.0 - settings.t) * settings.dof7_start + settings.t * settings.dof7_end;
            let s8 = (1.0 - settings.t) * settings.dof8_start + settings.t * settings.dof8_end;

            settings.dof1 = s1;
            settings.dof2 = s2;
            settings.dof3 = s3;
            settings.dof4 = s4;
            settings.dof5 = s5;
            settings.dof6 = s6;
            settings.dof7 = s7;
            settings.dof8 = s8;

            set_robot_state(engine, robot, [s1,s2,s3,s4,s5,s6,s7,s8])

            if(settings.is_playing) {
                settings.t += 0.005;
                if(settings.t >= 1.0) {
                    settings.t = 0.0;
                }
            }

            refresh_displays(gui);
        });

    </script>
</body>
</html>